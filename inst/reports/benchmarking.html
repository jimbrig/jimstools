<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>benchmarking</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">benchmarking</h1>



<div id="overview" class="section level2">
<h2>Overview</h2>
<p>This Vignette compares variouse I/O and serialization approaches in R.</p>
<p>The packages compared are:</p>
<ul>
<li>Base read.csv/write.csv</li>
<li>Base readRDS/saveRDS</li>
<li>fread/fwrite from the <a href="https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html">data.table</a> package</li>
<li>write_feather / read_feather from the <a href="https://cran.r-project.org/web/packages/feather/index.html">feather</a> package</li>
<li>qsave / qwrite from <a href="https://github.com/traversc/qs">qs</a> package</li>
<li>read.fst / write.fst from <a href="https://github.com/fstpackage/fst">fst</a> package</li>
</ul>
</div>
<div id="preliminary-notes" class="section level2">
<h2>Preliminary Notes:</h2>
<ul>
<li><strong>fst</strong> only works with data.frames / tabular data but it does conserve classes (including dates)</li>
<li>Data frames stored in the <strong>fst</strong> format have full random access, both in column and rows</li>
</ul>
</div>
<div id="my-choice---qs" class="section level2">
<h2>My Choice - qs</h2>
<p>Inspired by the fst package, qs uses a similar block-compression design using either the lz4 or zstd compression libraries. It differs in that it applies a more general approach for attributes and object references.</p>
<p>saveRDS and readRDS are the standard for serialization of R data, but these functions are not optimized for speed. On the other hand, fst is extremely fast, but only works on data.frame’s and certain column types.</p>
<p>qs is both extremely fast and general: it can serialize any R object like saveRDS and is just as fast and sometimes faster than fst.</p>
</div>
<div id="benchmarking-profiling" class="section level2">
<h2>Benchmarking / Profiling</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="kw">rnorm</span>(<span class="fl">5e6</span>), </a>
<a class="sourceLine" id="cb1-2" title="2">                  <span class="dt">y =</span> <span class="kw">sample</span>(<span class="fl">5e6</span>), </a>
<a class="sourceLine" id="cb1-3" title="3">                  <span class="dt">z =</span> <span class="kw">sample</span>(letters,<span class="fl">5e6</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb1-4" title="4">                  <span class="dt">l =</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="ot">TRUE</span>, <span class="fl">5e6</span><span class="op">/</span><span class="dv">2</span>), <span class="kw">rep</span>(<span class="ot">FALSE</span>, <span class="fl">5e6</span><span class="op">/</span><span class="dv">2</span>)))</a>
<a class="sourceLine" id="cb1-5" title="5"></a>
<a class="sourceLine" id="cb1-6" title="6">dir &lt;-<span class="st"> </span><span class="kw">tempdir</span>()</a>
<a class="sourceLine" id="cb1-7" title="7"></a>
<a class="sourceLine" id="cb1-8" title="8">base_file &lt;-<span class="st"> </span>fs<span class="op">::</span><span class="kw">path</span>(dir, <span class="st">&quot;dat_base.csv&quot;</span>)</a>
<a class="sourceLine" id="cb1-9" title="9">rds_file &lt;-<span class="st"> </span>fs<span class="op">::</span><span class="kw">path</span>(dir, <span class="st">&quot;dat_rds.RDS&quot;</span>)</a>
<a class="sourceLine" id="cb1-10" title="10">fwrite_file &lt;-<span class="st"> </span>fs<span class="op">::</span><span class="kw">path</span>(dir, <span class="st">&quot;dat_fwrite.csv&quot;</span>)</a>
<a class="sourceLine" id="cb1-11" title="11">feather_file &lt;-<span class="st"> </span>fs<span class="op">::</span><span class="kw">path</span>(dir, <span class="st">&quot;dat_feather.feather&quot;</span>)</a>
<a class="sourceLine" id="cb1-12" title="12">qs_file &lt;-<span class="st"> </span>fs<span class="op">::</span><span class="kw">path</span>(dir, <span class="st">&quot;dat_qs.qs&quot;</span>)</a>
<a class="sourceLine" id="cb1-13" title="13">fst_file &lt;-<span class="st"> </span>fs<span class="op">::</span><span class="kw">path</span>(dir, <span class="st">&quot;dat_fst.fst&quot;</span>)</a>
<a class="sourceLine" id="cb1-14" title="14"></a>
<a class="sourceLine" id="cb1-15" title="15">save_bench &lt;-<span class="st"> </span>bench<span class="op">::</span><span class="kw">mark</span>(</a>
<a class="sourceLine" id="cb1-16" title="16">  <span class="dt">base =</span> <span class="kw">write.csv</span>(dat, base_file),</a>
<a class="sourceLine" id="cb1-17" title="17">  <span class="dt">rds =</span> <span class="kw">saveRDS</span>(dat, rds_file),</a>
<a class="sourceLine" id="cb1-18" title="18">  <span class="dt">fwrite =</span> data.table<span class="op">::</span><span class="kw">fwrite</span>(dat, fwrite_file),</a>
<a class="sourceLine" id="cb1-19" title="19">  <span class="dt">feather =</span> <span class="kw">write_feather</span>(dat, feather_file),</a>
<a class="sourceLine" id="cb1-20" title="20">  <span class="dt">qs =</span> qs<span class="op">::</span><span class="kw">qsave</span>(dat, qs_file, <span class="dt">preset =</span> <span class="st">&quot;fast&quot;</span>, <span class="dt">algorithm =</span> <span class="st">&quot;lz4&quot;</span>, </a>
<a class="sourceLine" id="cb1-21" title="21">                 <span class="dt">compress_level =</span> <span class="dv">100</span>, <span class="dt">shuffle_control =</span> <span class="dv">0</span>, </a>
<a class="sourceLine" id="cb1-22" title="22">                 <span class="dt">nthreads =</span> <span class="dv">8</span>, <span class="dt">check_hash =</span> <span class="ot">FALSE</span>),</a>
<a class="sourceLine" id="cb1-23" title="23">  <span class="dt">fst =</span> fst<span class="op">::</span><span class="kw">write.fst</span>(dat, fst_file), </a>
<a class="sourceLine" id="cb1-24" title="24">  <span class="dt">check =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb1-25" title="25">  <span class="dt">iterations =</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb1-26" title="26">)</a>
<a class="sourceLine" id="cb1-27" title="27"></a>
<a class="sourceLine" id="cb1-28" title="28">read_bench &lt;-<span class="st"> </span>bench<span class="op">::</span><span class="kw">mark</span>(</a>
<a class="sourceLine" id="cb1-29" title="29">  <span class="dt">base =</span> <span class="kw">read.csv</span>(base_file),</a>
<a class="sourceLine" id="cb1-30" title="30">  <span class="dt">rds =</span> <span class="kw">readRDS</span>(rds_file),</a>
<a class="sourceLine" id="cb1-31" title="31">  <span class="dt">fread =</span> data.table<span class="op">::</span><span class="kw">fread</span>(fwrite_file),</a>
<a class="sourceLine" id="cb1-32" title="32">  <span class="dt">feather =</span> <span class="kw">read_feather</span>(feather_file),</a>
<a class="sourceLine" id="cb1-33" title="33">  <span class="dt">qs =</span> qs<span class="op">::</span><span class="kw">qread</span>(qs_file, <span class="dt">nthreads =</span> <span class="dv">8</span>),</a>
<a class="sourceLine" id="cb1-34" title="34">  <span class="dt">fst =</span> fst<span class="op">::</span><span class="kw">read.fst</span>(fst_file),</a>
<a class="sourceLine" id="cb1-35" title="35">  <span class="dt">check =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb1-36" title="36">  <span class="dt">iterations =</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb1-37" title="37">)</a></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">summary</span>(save_bench) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">expression =</span> forcats<span class="op">::</span><span class="kw">fct_reorder</span>(<span class="kw">as.character</span>(expression), min, <span class="dt">.desc =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="st">  </span><span class="kw">as_bench_mark</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="st">  </span><span class="kw">select_if</span>(purrr<span class="op">::</span><span class="kw">negate</span>(is.list)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="st">`</span><span class="dt">gc/sec</span><span class="st">`</span>, <span class="op">-</span>n_itr, <span class="op">-</span>n_gc) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="st">  </span><span class="kw">kable</span>(<span class="dt">booktabs =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
expression
</th>
<th style="text-align:right;">
min
</th>
<th style="text-align:right;">
median
</th>
<th style="text-align:right;">
itr/sec
</th>
<th style="text-align:right;">
mem_alloc
</th>
<th style="text-align:right;">
total_time
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
base
</td>
<td style="text-align:right;">
28.47s
</td>
<td style="text-align:right;">
28.47s
</td>
<td style="text-align:right;">
0.0351193
</td>
<td style="text-align:right;">
87.35MB
</td>
<td style="text-align:right;">
28.47s
</td>
</tr>
<tr>
<td style="text-align:left;">
rds
</td>
<td style="text-align:right;">
3.88s
</td>
<td style="text-align:right;">
3.88s
</td>
<td style="text-align:right;">
0.2577364
</td>
<td style="text-align:right;">
8.63KB
</td>
<td style="text-align:right;">
3.88s
</td>
</tr>
<tr>
<td style="text-align:left;">
fwrite
</td>
<td style="text-align:right;">
369.7ms
</td>
<td style="text-align:right;">
369.7ms
</td>
<td style="text-align:right;">
2.7049132
</td>
<td style="text-align:right;">
127.88KB
</td>
<td style="text-align:right;">
369.7ms
</td>
</tr>
<tr>
<td style="text-align:left;">
feather
</td>
<td style="text-align:right;">
252.47ms
</td>
<td style="text-align:right;">
252.47ms
</td>
<td style="text-align:right;">
3.9607915
</td>
<td style="text-align:right;">
10.86KB
</td>
<td style="text-align:right;">
252.47ms
</td>
</tr>
<tr>
<td style="text-align:left;">
qs
</td>
<td style="text-align:right;">
48.23ms
</td>
<td style="text-align:right;">
48.23ms
</td>
<td style="text-align:right;">
20.7334258
</td>
<td style="text-align:right;">
9.16KB
</td>
<td style="text-align:right;">
48.23ms
</td>
</tr>
<tr>
<td style="text-align:left;">
fst
</td>
<td style="text-align:right;">
38.76ms
</td>
<td style="text-align:right;">
38.76ms
</td>
<td style="text-align:right;">
25.7983289
</td>
<td style="text-align:right;">
19.88KB
</td>
<td style="text-align:right;">
38.76ms
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">autoplot</span>(save_bench, <span class="st">&quot;boxplot&quot;</span>)</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="co">#&gt; Loading required namespace: tidyr</span></a></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">summary</span>(read_bench) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">expression =</span> forcats<span class="op">::</span><span class="kw">fct_reorder</span>(<span class="kw">as.character</span>(expression), min, <span class="dt">.desc =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="st">  </span><span class="kw">as_bench_mark</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="st">  </span><span class="kw">select_if</span>(purrr<span class="op">::</span><span class="kw">negate</span>(is.list)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="st">`</span><span class="dt">gc/sec</span><span class="st">`</span>, <span class="op">-</span>n_itr, <span class="op">-</span>n_gc) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="st">  </span><span class="kw">kable</span>(<span class="dt">booktabs =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
expression
</th>
<th style="text-align:right;">
min
</th>
<th style="text-align:right;">
median
</th>
<th style="text-align:right;">
itr/sec
</th>
<th style="text-align:right;">
mem_alloc
</th>
<th style="text-align:right;">
total_time
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
base
</td>
<td style="text-align:right;">
11.4s
</td>
<td style="text-align:right;">
11.4s
</td>
<td style="text-align:right;">
0.0877047
</td>
<td style="text-align:right;">
1.12GB
</td>
<td style="text-align:right;">
11.4s
</td>
</tr>
<tr>
<td style="text-align:left;">
rds
</td>
<td style="text-align:right;">
407.5ms
</td>
<td style="text-align:right;">
407.5ms
</td>
<td style="text-align:right;">
2.4537289
</td>
<td style="text-align:right;">
95.37MB
</td>
<td style="text-align:right;">
407.5ms
</td>
</tr>
<tr>
<td style="text-align:left;">
fread
</td>
<td style="text-align:right;">
150.6ms
</td>
<td style="text-align:right;">
150.6ms
</td>
<td style="text-align:right;">
6.6420596
</td>
<td style="text-align:right;">
126.32MB
</td>
<td style="text-align:right;">
150.6ms
</td>
</tr>
<tr>
<td style="text-align:left;">
feather
</td>
<td style="text-align:right;">
62.4ms
</td>
<td style="text-align:right;">
62.4ms
</td>
<td style="text-align:right;">
16.0323601
</td>
<td style="text-align:right;">
95.47MB
</td>
<td style="text-align:right;">
62.4ms
</td>
</tr>
<tr>
<td style="text-align:left;">
qs
</td>
<td style="text-align:right;">
44.3ms
</td>
<td style="text-align:right;">
44.3ms
</td>
<td style="text-align:right;">
22.5826828
</td>
<td style="text-align:right;">
95.37MB
</td>
<td style="text-align:right;">
44.3ms
</td>
</tr>
<tr>
<td style="text-align:left;">
fst
</td>
<td style="text-align:right;">
29.4ms
</td>
<td style="text-align:right;">
29.4ms
</td>
<td style="text-align:right;">
34.0492456
</td>
<td style="text-align:right;">
114.49MB
</td>
<td style="text-align:right;">
29.4ms
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">autoplot</span>(read_bench)</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="co">#&gt; Warning in f(...): The default behavior of beeswarm has changed in version</span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="co">#&gt; 0.6.0. In versions &lt;0.6.0, this plot would have been dodged on the y-axis. In</span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="co">#&gt; versions &gt;=0.6.0, grouponX=FALSE must be explicitly set to group on y-axis.</span></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="co">#&gt; Please set grouponX=TRUE/FALSE to avoid this warning and ensure proper axis</span></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="co">#&gt; choice.</span></a></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="microbenchmark" class="section level2">
<h2>Microbenchmark</h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">save_bench &lt;-<span class="st"> </span><span class="kw">microbenchmark</span>(</a>
<a class="sourceLine" id="cb6-2" title="2">  <span class="dt">base =</span> <span class="kw">write.csv</span>(dat, base_file),</a>
<a class="sourceLine" id="cb6-3" title="3">  <span class="dt">rds =</span> <span class="kw">saveRDS</span>(dat, rds_file),</a>
<a class="sourceLine" id="cb6-4" title="4">  <span class="dt">fwrite =</span> data.table<span class="op">::</span><span class="kw">fwrite</span>(dat, fwrite_file),</a>
<a class="sourceLine" id="cb6-5" title="5">  <span class="dt">feather =</span> <span class="kw">write_feather</span>(dat, feather_file),</a>
<a class="sourceLine" id="cb6-6" title="6">  <span class="dt">qs =</span> qs<span class="op">::</span><span class="kw">qsave</span>(dat, qs_file, <span class="dt">preset =</span> <span class="st">&quot;fast&quot;</span>, <span class="dt">algorithm =</span> <span class="st">&quot;lz4&quot;</span>, </a>
<a class="sourceLine" id="cb6-7" title="7">                 <span class="dt">compress_level =</span> <span class="dv">100</span>, <span class="dt">shuffle_control =</span> <span class="dv">0</span>, </a>
<a class="sourceLine" id="cb6-8" title="8">                 <span class="dt">nthreads =</span> <span class="dv">8</span>, <span class="dt">check_hash =</span> <span class="ot">FALSE</span>),</a>
<a class="sourceLine" id="cb6-9" title="9">  <span class="dt">fst =</span> fst<span class="op">::</span><span class="kw">write.fst</span>(dat, fst_file), </a>
<a class="sourceLine" id="cb6-10" title="10">  <span class="dt">times =</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb6-11" title="11">)</a>
<a class="sourceLine" id="cb6-12" title="12"></a>
<a class="sourceLine" id="cb6-13" title="13">read_bench &lt;-<span class="st"> </span><span class="kw">microbenchmark</span>(</a>
<a class="sourceLine" id="cb6-14" title="14">  <span class="dt">base =</span> <span class="kw">read.csv</span>(base_file),</a>
<a class="sourceLine" id="cb6-15" title="15">  <span class="dt">rds =</span> <span class="kw">readRDS</span>(rds_file),</a>
<a class="sourceLine" id="cb6-16" title="16">  <span class="dt">fread =</span> data.table<span class="op">::</span><span class="kw">fread</span>(fwrite_file),</a>
<a class="sourceLine" id="cb6-17" title="17">  <span class="dt">feather =</span> <span class="kw">read_feather</span>(feather_file),</a>
<a class="sourceLine" id="cb6-18" title="18">  <span class="dt">qs =</span> qs<span class="op">::</span><span class="kw">qread</span>(qs_file, <span class="dt">nthreads =</span> <span class="dv">8</span>),</a>
<a class="sourceLine" id="cb6-19" title="19">  <span class="dt">fst =</span> fst<span class="op">::</span><span class="kw">read.fst</span>(fst_file),</a>
<a class="sourceLine" id="cb6-20" title="20">  <span class="dt">times =</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb6-21" title="21">)</a></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">save_bench</a>
<a class="sourceLine" id="cb7-2" title="2"><span class="co">#&gt; Unit: milliseconds</span></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="co">#&gt;     expr         min          lq        mean      median          uq</span></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="co">#&gt;     base 25198.32155 25198.32155 25198.32155 25198.32155 25198.32155</span></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="co">#&gt;      rds  4369.09885  4369.09885  4369.09885  4369.09885  4369.09885</span></a>
<a class="sourceLine" id="cb7-6" title="6"><span class="co">#&gt;   fwrite   386.96843   386.96843   386.96843   386.96843   386.96843</span></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="co">#&gt;  feather   230.80496   230.80496   230.80496   230.80496   230.80496</span></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="co">#&gt;       qs    43.80220    43.80220    43.80220    43.80220    43.80220</span></a>
<a class="sourceLine" id="cb7-9" title="9"><span class="co">#&gt;      fst    43.44826    43.44826    43.44826    43.44826    43.44826</span></a>
<a class="sourceLine" id="cb7-10" title="10"><span class="co">#&gt;          max neval</span></a>
<a class="sourceLine" id="cb7-11" title="11"><span class="co">#&gt;  25198.32155     1</span></a>
<a class="sourceLine" id="cb7-12" title="12"><span class="co">#&gt;   4369.09885     1</span></a>
<a class="sourceLine" id="cb7-13" title="13"><span class="co">#&gt;    386.96843     1</span></a>
<a class="sourceLine" id="cb7-14" title="14"><span class="co">#&gt;    230.80496     1</span></a>
<a class="sourceLine" id="cb7-15" title="15"><span class="co">#&gt;     43.80220     1</span></a>
<a class="sourceLine" id="cb7-16" title="16"><span class="co">#&gt;     43.44826     1</span></a></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">boxplot</span>(save_bench)</a></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">read_bench</a>
<a class="sourceLine" id="cb9-2" title="2"><span class="co">#&gt; Unit: milliseconds</span></a>
<a class="sourceLine" id="cb9-3" title="3"><span class="co">#&gt;     expr         min          lq        mean      median          uq</span></a>
<a class="sourceLine" id="cb9-4" title="4"><span class="co">#&gt;     base 12159.51571 12159.51571 12159.51571 12159.51571 12159.51571</span></a>
<a class="sourceLine" id="cb9-5" title="5"><span class="co">#&gt;      rds   442.93306   442.93306   442.93306   442.93306   442.93306</span></a>
<a class="sourceLine" id="cb9-6" title="6"><span class="co">#&gt;    fread   328.11119   328.11119   328.11119   328.11119   328.11119</span></a>
<a class="sourceLine" id="cb9-7" title="7"><span class="co">#&gt;  feather    37.94669    37.94669    37.94669    37.94669    37.94669</span></a>
<a class="sourceLine" id="cb9-8" title="8"><span class="co">#&gt;       qs    32.50717    32.50717    32.50717    32.50717    32.50717</span></a>
<a class="sourceLine" id="cb9-9" title="9"><span class="co">#&gt;      fst    37.80850    37.80850    37.80850    37.80850    37.80850</span></a>
<a class="sourceLine" id="cb9-10" title="10"><span class="co">#&gt;          max neval</span></a>
<a class="sourceLine" id="cb9-11" title="11"><span class="co">#&gt;  12159.51571     1</span></a>
<a class="sourceLine" id="cb9-12" title="12"><span class="co">#&gt;    442.93306     1</span></a>
<a class="sourceLine" id="cb9-13" title="13"><span class="co">#&gt;    328.11119     1</span></a>
<a class="sourceLine" id="cb9-14" title="14"><span class="co">#&gt;     37.94669     1</span></a>
<a class="sourceLine" id="cb9-15" title="15"><span class="co">#&gt;     32.50717     1</span></a>
<a class="sourceLine" id="cb9-16" title="16"><span class="co">#&gt;     37.80850     1</span></a></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="kw">boxplot</span>(read_bench)</a></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="co"># fs::dir_delete(dir)</span></a>
<a class="sourceLine" id="cb11-2" title="2"><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb11-3" title="3">  base_file,</a>
<a class="sourceLine" id="cb11-4" title="4">  rds_file,</a>
<a class="sourceLine" id="cb11-5" title="5">  fwrite_file,</a>
<a class="sourceLine" id="cb11-6" title="6">  feather_file,</a>
<a class="sourceLine" id="cb11-7" title="7">  qs_file,</a>
<a class="sourceLine" id="cb11-8" title="8">  fst_file</a>
<a class="sourceLine" id="cb11-9" title="9">) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-10" title="10"><span class="st">  </span>purrr<span class="op">::</span><span class="kw">walk</span>(fs<span class="op">::</span>file_delete)</a></code></pre></div>
</div>
<div id="example-usage" class="section level2">
<h2>Example Usage</h2>
<p>Here’s some example “caching” utility functions utilizing the <strong>qs</strong> package:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="co">#&#39; Write Cache</span></a>
<a class="sourceLine" id="cb12-2" title="2"><span class="co">#&#39;</span></a>
<a class="sourceLine" id="cb12-3" title="3"><span class="co">#&#39; Quick caching utility write function.</span></a>
<a class="sourceLine" id="cb12-4" title="4"><span class="co">#&#39;</span></a>
<a class="sourceLine" id="cb12-5" title="5"><span class="co">#&#39; @param x object to cache</span></a>
<a class="sourceLine" id="cb12-6" title="6"><span class="co">#&#39; @param name name to store object with</span></a>
<a class="sourceLine" id="cb12-7" title="7"><span class="co">#&#39; @param cache_dir path to cache directory</span></a>
<a class="sourceLine" id="cb12-8" title="8"><span class="co">#&#39; @param overwrite logical (default = TRUE)</span></a>
<a class="sourceLine" id="cb12-9" title="9"><span class="co">#&#39;</span></a>
<a class="sourceLine" id="cb12-10" title="10"><span class="co">#&#39; @return x</span></a>
<a class="sourceLine" id="cb12-11" title="11"><span class="co">#&#39; @export</span></a>
<a class="sourceLine" id="cb12-12" title="12"><span class="co">#&#39;</span></a>
<a class="sourceLine" id="cb12-13" title="13"><span class="co">#&#39; @importFrom fs dir_exists dir_create path</span></a>
<a class="sourceLine" id="cb12-14" title="14"><span class="co">#&#39; @importFrom qs qsave</span></a>
<a class="sourceLine" id="cb12-15" title="15"><span class="co">#&#39;</span></a>
<a class="sourceLine" id="cb12-16" title="16"><span class="co">#&#39; @examples</span></a>
<a class="sourceLine" id="cb12-17" title="17"><span class="co">#&#39; mydata &lt;- mtcars</span></a>
<a class="sourceLine" id="cb12-18" title="18"><span class="co">#&#39; write_cache(mydata) # will save to &#39;cache/mydata&#39;.</span></a>
<a class="sourceLine" id="cb12-19" title="19"><span class="co">#&#39; write_cache(mydata, &quot;mydata-v2&quot;, cache_dir = &quot;data/temp&quot;) # will save to &#39;data/temp/mydata-v2&#39;</span></a>
<a class="sourceLine" id="cb12-20" title="20">write_cache &lt;-<span class="st"> </span><span class="cf">function</span>(x,</a>
<a class="sourceLine" id="cb12-21" title="21">                        <span class="dt">name =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb12-22" title="22">                        <span class="dt">cache_dir =</span> <span class="st">&quot;cache&quot;</span>,</a>
<a class="sourceLine" id="cb12-23" title="23">                        <span class="dt">overwrite =</span> <span class="ot">TRUE</span>) {</a>
<a class="sourceLine" id="cb12-24" title="24"></a>
<a class="sourceLine" id="cb12-25" title="25">  <span class="cf">if</span> (<span class="op">!</span>fs<span class="op">::</span><span class="kw">dir_exists</span>(cache_dir)) fs<span class="op">::</span><span class="kw">dir_create</span>(cache_dir)</a>
<a class="sourceLine" id="cb12-26" title="26">  </a>
<a class="sourceLine" id="cb12-27" title="27">  <span class="cf">if</span> (<span class="kw">is.null</span>(name)) name &lt;-<span class="st"> </span><span class="kw">deparse</span>(<span class="kw">substitute</span>(x))</a>
<a class="sourceLine" id="cb12-28" title="28">  </a>
<a class="sourceLine" id="cb12-29" title="29">  qs_file &lt;-<span class="st"> </span>fs<span class="op">::</span><span class="kw">path</span>(cache_dir, name)</a>
<a class="sourceLine" id="cb12-30" title="30">  </a>
<a class="sourceLine" id="cb12-31" title="31">  qs<span class="op">::</span><span class="kw">qsave</span>(x, qs_file)</a>
<a class="sourceLine" id="cb12-32" title="32">  </a>
<a class="sourceLine" id="cb12-33" title="33">  <span class="kw">message</span>(<span class="st">&quot;Object &quot;</span>, name, <span class="st">&quot;has been cached at &#39;&quot;</span>, qs_file, <span class="st">&quot;&#39;.&quot;</span>)</a>
<a class="sourceLine" id="cb12-34" title="34">  </a>
<a class="sourceLine" id="cb12-35" title="35">  <span class="kw">return</span>(x)</a>
<a class="sourceLine" id="cb12-36" title="36"></a>
<a class="sourceLine" id="cb12-37" title="37">}</a>
<a class="sourceLine" id="cb12-38" title="38"></a>
<a class="sourceLine" id="cb12-39" title="39"><span class="co">#&#39; Read Cache</span></a>
<a class="sourceLine" id="cb12-40" title="40"><span class="co">#&#39;</span></a>
<a class="sourceLine" id="cb12-41" title="41"><span class="co">#&#39; Quick caching utility read function.</span></a>
<a class="sourceLine" id="cb12-42" title="42"><span class="co">#&#39;</span></a>
<a class="sourceLine" id="cb12-43" title="43"><span class="co">#&#39; @param name name of object to read in.</span></a>
<a class="sourceLine" id="cb12-44" title="44"><span class="co">#&#39; @param cache_dir path to cache directory.</span></a>
<a class="sourceLine" id="cb12-45" title="45"><span class="co">#&#39;</span></a>
<a class="sourceLine" id="cb12-46" title="46"><span class="co">#&#39; @return invisibly attaches object to parent global environment</span></a>
<a class="sourceLine" id="cb12-47" title="47"><span class="co">#&#39; @export</span></a>
<a class="sourceLine" id="cb12-48" title="48"><span class="co">#&#39; @importFrom fs path file_exists</span></a>
<a class="sourceLine" id="cb12-49" title="49"><span class="co">#&#39; @importFrom fst read_fst</span></a>
<a class="sourceLine" id="cb12-50" title="50">read_cache &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">name =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb12-51" title="51">                       <span class="dt">cache_dir =</span> <span class="st">&quot;cache&quot;</span>) {</a>
<a class="sourceLine" id="cb12-52" title="52"></a>
<a class="sourceLine" id="cb12-53" title="53">  <span class="cf">if</span> (<span class="kw">is.null</span>(name)) name &lt;-<span class="st"> </span><span class="kw">deparse</span>(<span class="kw">substitute</span>(x))</a>
<a class="sourceLine" id="cb12-54" title="54">  </a>
<a class="sourceLine" id="cb12-55" title="55">  qs_file &lt;-<span class="st"> </span>fs<span class="op">::</span><span class="kw">path</span>(cache_dir, name)</a>
<a class="sourceLine" id="cb12-56" title="56">  </a>
<a class="sourceLine" id="cb12-57" title="57">  <span class="cf">if</span> (<span class="op">!</span>fs<span class="op">::</span><span class="kw">file_exists</span>(qs_file)) {</a>
<a class="sourceLine" id="cb12-58" title="58">    <span class="kw">stop</span>(<span class="st">&quot;File not found in &quot;</span>, cache_dir)</a>
<a class="sourceLine" id="cb12-59" title="59">  }</a>
<a class="sourceLine" id="cb12-60" title="60">  </a>
<a class="sourceLine" id="cb12-61" title="61">  <span class="cf">if</span> (fs<span class="op">::</span><span class="kw">file_exists</span>(qs_file)) out &lt;-<span class="st"> </span>qs<span class="op">::</span><span class="kw">qread</span>(qs_file)</a>
<a class="sourceLine" id="cb12-62" title="62">  </a>
<a class="sourceLine" id="cb12-63" title="63">  <span class="kw">assign</span>(name, out, <span class="dt">envir =</span> .GlobalEnv)</a>
<a class="sourceLine" id="cb12-64" title="64">  </a>
<a class="sourceLine" id="cb12-65" title="65">  <span class="kw">return</span>(<span class="kw">invisible</span>())</a>
<a class="sourceLine" id="cb12-66" title="66"></a>
<a class="sourceLine" id="cb12-67" title="67">}</a></code></pre></div>
<p>An alternative could be to use <strong>fst</strong> and <strong>RDS</strong> depending on what you are trying to save:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">write_cache &lt;-<span class="st"> </span><span class="cf">function</span>(x,</a>
<a class="sourceLine" id="cb13-2" title="2">                        <span class="dt">name =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb13-3" title="3">                        <span class="dt">cache_dir =</span> <span class="st">&quot;cache&quot;</span>,</a>
<a class="sourceLine" id="cb13-4" title="4">                        <span class="dt">overwrite =</span> <span class="ot">TRUE</span>) {</a>
<a class="sourceLine" id="cb13-5" title="5"></a>
<a class="sourceLine" id="cb13-6" title="6">  <span class="cf">if</span> (<span class="op">!</span><span class="kw">dir.exists</span>(cache_dir)) <span class="kw">dir.create</span>(cache_dir)</a>
<a class="sourceLine" id="cb13-7" title="7"></a>
<a class="sourceLine" id="cb13-8" title="8">  <span class="cf">if</span> (<span class="kw">is.null</span>(name)) name &lt;-<span class="st"> </span><span class="kw">deparse</span>(<span class="kw">substitute</span>(x))</a>
<a class="sourceLine" id="cb13-9" title="9"></a>
<a class="sourceLine" id="cb13-10" title="10">  fst_file &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="kw">file.path</span>(cache_dir, name), <span class="st">&quot;.fst&quot;</span>)</a>
<a class="sourceLine" id="cb13-11" title="11">  rds_file &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="kw">file.path</span>(cache_dir, name), <span class="st">&quot;.RDS&quot;</span>)</a>
<a class="sourceLine" id="cb13-12" title="12"></a>
<a class="sourceLine" id="cb13-13" title="13">  <span class="cf">if</span> (tibble<span class="op">::</span><span class="kw">is_tibble</span>(x) <span class="op">||</span><span class="st"> </span><span class="kw">is.data.frame</span>(x)) {</a>
<a class="sourceLine" id="cb13-14" title="14"></a>
<a class="sourceLine" id="cb13-15" title="15">    <span class="kw">tryCatch</span>(</a>
<a class="sourceLine" id="cb13-16" title="16">      fst<span class="op">::</span><span class="kw">write_fst</span>(x, fst_file),</a>
<a class="sourceLine" id="cb13-17" title="17">      <span class="dt">error =</span> <span class="cf">function</span>(e, ...) <span class="kw">saveRDS</span>(x, rds_file)</a>
<a class="sourceLine" id="cb13-18" title="18">    )</a>
<a class="sourceLine" id="cb13-19" title="19"></a>
<a class="sourceLine" id="cb13-20" title="20">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb13-21" title="21"></a>
<a class="sourceLine" id="cb13-22" title="22">    <span class="kw">saveRDS</span>(x, rds_file)</a>
<a class="sourceLine" id="cb13-23" title="23"></a>
<a class="sourceLine" id="cb13-24" title="24">  }</a>
<a class="sourceLine" id="cb13-25" title="25"></a>
<a class="sourceLine" id="cb13-26" title="26">  <span class="cf">if</span> (<span class="kw">file.exists</span>(fst_file) <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw">file.exists</span>(rds_file)) fs<span class="op">::</span><span class="kw">file_delete</span>(fst_file)</a>
<a class="sourceLine" id="cb13-27" title="27"></a>
<a class="sourceLine" id="cb13-28" title="28">}</a>
<a class="sourceLine" id="cb13-29" title="29"></a>
<a class="sourceLine" id="cb13-30" title="30">read_cache &lt;-<span class="st"> </span><span class="cf">function</span>(name,</a>
<a class="sourceLine" id="cb13-31" title="31">                       <span class="dt">cache_dir =</span> <span class="st">&quot;cache&quot;</span>) {</a>
<a class="sourceLine" id="cb13-32" title="32"></a>
<a class="sourceLine" id="cb13-33" title="33">  fst_file &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="kw">file.path</span>(cache_dir, name), <span class="st">&quot;.fst&quot;</span>)</a>
<a class="sourceLine" id="cb13-34" title="34">  rds_file &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="kw">file.path</span>(cache_dir, name), <span class="st">&quot;.RDS&quot;</span>)</a>
<a class="sourceLine" id="cb13-35" title="35"></a>
<a class="sourceLine" id="cb13-36" title="36">  <span class="cf">if</span> (<span class="op">!</span><span class="kw">file.exists</span>(fst_file) <span class="op">&amp;&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">file.exists</span>(rds_file)) <span class="kw">stop</span>(<span class="st">&quot;File not found in &quot;</span>, cache_dir)</a>
<a class="sourceLine" id="cb13-37" title="37"></a>
<a class="sourceLine" id="cb13-38" title="38">  <span class="cf">if</span> (<span class="kw">file.exists</span>(fst_file)) out &lt;-<span class="st"> </span><span class="kw">read_fst</span>(fst_file)</a>
<a class="sourceLine" id="cb13-39" title="39"></a>
<a class="sourceLine" id="cb13-40" title="40">  <span class="cf">if</span> (<span class="kw">file.exists</span>(rds_file)) out &lt;-<span class="st"> </span><span class="kw">readRDS</span>(rds_file)</a>
<a class="sourceLine" id="cb13-41" title="41"></a>
<a class="sourceLine" id="cb13-42" title="42">  <span class="kw">assign</span>(name, out, <span class="dt">envir =</span> .GlobalEnv)</a>
<a class="sourceLine" id="cb13-43" title="43"></a>
<a class="sourceLine" id="cb13-44" title="44">  <span class="kw">return</span>(<span class="kw">invisible</span>())</a>
<a class="sourceLine" id="cb13-45" title="45"></a>
<a class="sourceLine" id="cb13-46" title="46">}</a></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
